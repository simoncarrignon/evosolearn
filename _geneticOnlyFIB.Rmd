
# Explore genetic evolution only: 

```{r echo=FALSE, message=FALSE}

do_it=TRUE

#save(file="data/constant_env.bin",constant_env)
#save(file="data/v.bin",v)
#save(file="data/noisy_env.bin",noisy_env)
#save(file="data/noisy_env_omega",noisy_env_omega)
#save(file="data/moving_theta",moving_theta)
#save(file="data/omega1.bin",omega1)
#save(file="data/omega2.bin",omega2)
#save(file="data/allStatics.bin",allStatics)

#load(file="data/constant_env.bin")
#load(file="data/v.bin")
#load(file="data/noisy_env.bin")
#load(file="data/noisy_env_omega")
#load(file="data/omega1.bin")
#load(file="data/omega2.bin")
#load(file="data/moving_theta")
#load(file="data/allStatics.bin")

```


## Constant Environment

Fixed parameter:
```{r}
n=1000
b=2
tstep=50000
mu=c(x=0,y=0,z=0)
E=c(x=0,y=0,z=0)
m=c(x=0,y=0,z=0)
sigma=c(s=1,y=1,z=1)
```
Explored parameters:
```{r}
allparameters=list()
allparameters[["mu"]]=c(0.001,0.01)
allparameters[["K"]]=c(500,1000,2000)
allparameters[["E"]]=0 #no noise
allparameters[["m"]]=c(.05,.1,.2)
allparameters[["sigma"]]=c(1,2,4,10000)
allparameters[["delta"]]=c(0,.1,.2,.4,1)
allparameters[["vt"]]=0 #no rate of change
allparameters[["omega"]]=c(0,2)
allparameters[["outputrate"]]=100
parameters=as.data.frame(expand.grid(allparameters))
```

```{r,echo=F}
rmarkdown::paged_table(parameters)
```




```{r,eval=do_it}
allStatics=getAlllSummaries("finbitest/")
allStatics=updateScale(allStatics)
```

```{r}
constant_env=allStatics[allStatics$delta == 0,] 
```



### Trajectories

Check the trajectories of the simulation for the population size for different mutation rate $\mu$(from left to right: $\mu = 0, \mu = 0.001,\mu=0.01$), different selective pressure $\sigma_s$ (from top to bottomright: $\sigma_s = 0.1, \sigma_smu = 0.2,\sigma_s=0.4,\sigma_s=1000$) and  different carrying capacity $K$ 


```{r,fig.fullwidth=T,fig.height=10,fig.cap="Effective population size"}
#pdf("trajectory_N_const.pdf",width=12,height=16)
plotAllTrajVar(constant_env,m=0.05,E=0,obs="N")
#dev.off()
```
```{r,fig.fullwidth=T,fig.height=10,fig.cap="Variance"}
#pdf("trajectory_var_x_const.pdf",width=12,height=16)
plotAllTrajVar(constant_env,m=0.05,E=0,obs="var_x",ylim=c(0,.02))
#dev.off()
```

### Variance at equilibrium

Check the variance at the equilibrium:

```{r,fig.fullwidth=T,fig.height=11,warnings=F,message=F}
#pdf("equilibrium_var_x_const.pdf",width=12,height=16)
plotAllVariableSummaries(constant_env,E=0,estimate=eq2833b) #we use only simulations without noise
#dev.off()
```



## Constant but noisy environment
we use different  $\delta$  to generate environment with noise of growing variance

### Environment

```{r,fig.width=10,fig.height=5,fig.cap="effect of $\\delta$ on environment"}
d=c(0.00,0.01,0.10,0.20,0.40,1.00,10.00)
cols=colorRampPalette(c("black","grey"))(length(d))
names(cols)=d
omegas=1:2

plot(1,1,xlim=c(1,500),ylim=c(-10,10),type="n",xlab="t",ylab=expression(theta[t]))
for ( i in rev(d))
    lines(1:500,environment(500,omega=0,delta=i),col=cols[as.character(i)])
legend("topleft",legend=paste0("d=",d),col=cols,lty=1,bg="white")
```

To explore this we used the following parameters space:


```{r}
noisy_env = allStatics[allStatics$omega ==0,]
```


### Trajectories 

Check the trajectory off  the effective population size:
```{r,fig.width=20,fig.height=20}
#pdf("trajectory_N_noise.pdf",width=12,height=16)
plotAllTrajVar(noisy_env,m=0.05,E=0,obs="N")
#dev.off()
```

Check the trajectory off the mean variance:
```{r,fig.width=15,fig.height=10,fig.cap="Trajectory of Variance for noisy environment"}
#pdf("trajectory_var_x_noise.pdf",width=12,height=16)
plotAllTrajVar(noisy_env,m=0.05,E=0,obs="var_x",ylim=c(0,.03))
#dev.off()
```

### Variance at equilibrium

Check and compare the final variance :

```{r,fig.fullwidth=T,fig.height=10}
#pdf("equilibrium_var_x_noise.pdf",width=12,height=16)
plotAllVariableSummaries(noisy_env,E=0,estimate=eq2833b) 
#dev.off()
```



### Extinctions
Some of the data seems to be missing because when $\delta>\sigma$  we have extinctions, has shown in the Figure \@ref(fig:extinctionNoisy). 


```{r extinctionNoisyFIB,warning=FALSE}
#pdf
sigmas=unique(noisy_env$sigma)
cols=colorRampPalette(c("darkgreen","yellow"))(length(sigmas))
names(cols)=sigmas
tmpc=noisy_env[ noisy_env$mu == 0.01 & noisy_env$m == 0.2 ,]
plot(tmpc$delta,tmpc$extinction,log="xy",type="n",ylab="extinction time",xlab=expression(delta),main=bquote(mu == 0.01 ~ omega == 0))
for(s in sigmas){
    tmpc=noisy_env[ noisy_env$sigma==s & noisy_env$mu == 0.01 & noisy_env$m == 0.2 ,]
    Ks=sort(unique(tmpc$K))
    for(k in 1:length(Ks)){
        t=tmpc[tmpc$K==Ks[k],]
        r=tapply(t$extinction,t$delta,mean)
        lines(sort(unique(t$delta)),r,type="b",pch=k,col=cols[as.character(s)])
    }
}
legend("right",
       legend=c(paste0("K=",Ks),sapply(sigmas,function(s)as.expression(bquote(sigma==.(s))))),
       col=c(rep(1,length(Ks)),cols),
       lty=c(rep(NA,length(Ks)),rep(1,length(sigmas))),
       pch=c(seq_along(Ks),rep(NA,length(sigmas)))
       )
#dev.off()
```
